Hello all, 

Today we are going to hands-on on the Lateral Movement into AD by using BloodHound and SharpHound. 

BloodHound is a great tool for mapping out the objects in Active Directory, it uses JSON files to make Graphs to demonstrate the relationships between the objects in AD. We will see in details below

SharpHound is another great tool for enumerating the Objects and output the results in the JSON file.

We are assuming that we have a Shell, and we are on the Domain which we named ‘adlab.local’.

I have used the PowerView tool, another GREAT tool for enumerating objects in AD.

<img src="./../../Screenshot 2020-10-08 at 1.02.28 AM.png" width="300" height="300">

So before we proceed further, we need to understand the users that we have created for the demonstration.

Victim: This is the target user we have already access on it. This means, that we have a shell on a system that this user has access to.<br>
Victim2: Another user with a little higher privileges as compared to Victim user.<br>
Vulnerablegroup: Group which contains victim2 as a Member.<br>
Suser (Super User): This user is a member of the Domain Admins Group.

BloodHound Introduction

After running SharpHound, and import every JSON file returned by SharpHound in to BloodHound. These are the objects of the ‘adlab.local’ domain graph made by BloodHound, on which we need to focus on.

<img src="./../../Screenshot 2020-10-06 at 11.48.07 PM">

The most interested groups are Domain Admins, Administrators.

2. We will see what users are inside of Domain Admins

<img src="./../../Screenshot 2020-10-08 at 1.36.15 AM" width="300" height="300">

As you can see ‘suser’ is in the Group, so this will be our interested target, we will make a note of it. 

As you know, we have access to the Victim’s account, which is a domain account, and we also find out that there is another account named ‘suser’ which is a Domain Administrator. So let’s find out the path of the misconfiguration if available with the help of BloodHound.

We will give the start node as VICTIM@ADLAB.LOCAL and destination node as SUSER@ADLAB.LOCAL, and check the results.

<img src="./../../Screenshot 2020-10-08 at 1.43.11 AM" width="300" height="300">

And yes, we have one, as you can see, the starting node is victim@adlab.local, and the ending node is suser@adlab.local(The one that is not displaying).

So we found an attack path.

Let’s understand this:-

The victim user is having GenericAll permissions on Victim2 user, which means that we can do reset the password on the victim2 without even knowing the current password. Furthermore, Victim2 is a member of the Vulnerablegroup. 

The vulnerablegroup is having GenericAll permission on the last targeted user suser@adlab.local which means, if we can impersonate to victim2 user, we can change the password of the super admin user, and then we can impersonate to superuser and add our user i.e. victim into the Domain Admins Group which is the end goal.

Make sense?

Alright, let’s see how we can do it.

Right now we are a victim user, which is in the domain users group (Less privileged user).

<img src="./../../Screenshot 2020-10-08 at 1.51.12 AM" width="300" height="300">

As we know we can change the victim2 password because of GenericAll permission, so let’s change the password.

`CMD:- net user victim2 hacked123!@# /DOMAIN`

Result:

<img src="./../../Screenshot 2020-10-08 at 1.51.12 AM" width="300" height="300">
